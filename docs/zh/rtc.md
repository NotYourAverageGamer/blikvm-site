# **RTC时钟**

RTC（Real-Time Clock，实时时钟）的作用是提供设备或系统的实时时间和日期信息。它是一个独立的时钟芯片或模块，具有自己的电源，可以在设备关闭或断电时仍然保持时间的准确性。因国际快递电池不方便邮寄问题，出厂硬件无电池，需用户自己购买(纽扣电池型号CR1220)。BliKVM不同硬件版本上使用的RTC时钟型号不完全一样，使用方法也略有不同。

## **BliKVM V2 PCIe and BliKVM V3 Hat - pcf8563**

!!! info "1. 检查i2c总线上是否正常识别到了pcf8563 RTC时钟硬件，pcf8563的i2c地址是x51，本节所有命令均需在root权限下，执行下面的命令能正确查看到x51即证明rtc时钟已被i2c总线正确识别到。"
    ```
    root@mangopimcore:~# i2cdetect -y 1
        0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f
    00:                         -- -- -- -- -- -- -- --
    10: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- --
    20: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- --
    30: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- --
    40: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- --
    50: -- 51 -- -- -- -- -- -- -- -- -- -- -- -- -- --
    60: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- --
    70: -- -- -- -- -- -- -- --
    ```
!!! info "2. 向Linux 系统的i2c子系统注册一个新的i2c设备，该设备的型号是 pcf8563，设备的i2c地址为 0x51。再使用```ls /dev | grep rtc```命令查看是否正确出现rtc1设备，出现即注册成功。"
    ```
    echo pcf8563 0x51 > /sys/class/i2c-adapter/i2c-1/new_device
    ```

!!! info "3. 将当前系统时间设置为rtc时钟时间。"
    ```
    hwclock -f /dev/rtc0 -w
    ```

!!! info "4. 从rtc时钟读取时间，如果能读取到时间即表明rtc模块正常。"
    ```
    root@mangopimcore:~# hwclock -f /dev/rtc0 -r
    2023-05-28 05:04:08.679152-02:30
    ```

## **BliKVM V4 - pcf8563**

!!! info "1. 检查i2c总线上是否正常识别到了pcf8563 RTC时钟硬件，pcf8563的i2c地址是x51，本节所有命令均需在root权限下，执行下面的命令能正确查看到x51即证明rtc时钟已被i2c总线正确识别到。"
    ```
    root@mangopimcore:~# i2cdetect -y 0
        0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f
    00:                         -- -- -- -- -- -- -- --
    10: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- --
    20: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- --
    30: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- --
    40: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- --
    50: -- 51 -- -- -- -- -- -- -- -- -- -- -- -- -- --
    60: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- --
    70: -- -- -- -- -- -- -- --
    ```
!!! info "2. 向Linux 系统的i2c子系统注册一个新的i2c设备，该设备的型号是 pcf8563，设备的i2c地址为 0x51。再使用```ls /dev | grep rtc```命令查看是否正确出现rtc1设备，出现即注册成功。"
    ```
    echo pcf8563 0x51 > /sys/class/i2c-adapter/i2c-0/new_device
    ```

!!! info "3. 将当前系统时间设置为rtc时钟时间。"
    ```
    hwclock -f /dev/rtc1 -w
    ```

!!! info "4. 从rtc时钟读取时间，如果能读取到时间即表明rtc模块正常。"
    ```
    root@mangopimcore:~# hwclock -f /dev/rtc1 -r
    2023-05-28 05:04:08.679152-02:30
    ```